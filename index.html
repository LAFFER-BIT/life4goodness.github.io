<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®æ‹‰èŠ™å®¶åº­å¨æˆ¿</title>
    
    <!-- LeanCloud SDK -->
    <script src="https://cdn.jsdelivr.net/npm/leancloud-storage@4.15.2/dist/av-min.js"></script>
    
    <!-- é…ç½®æ–‡ä»¶ï¼ˆä»å¤–éƒ¨åŠ è½½ï¼Œåœ¨éƒ¨ç½²æ—¶ç”±GitHub Actionsç”Ÿæˆï¼‰ -->
    <script src="./config.js"></script>

    <style>
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif; background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%); min-height: 100vh; padding: 10px; }
        .container { max-width: 100%; margin: 0 auto; padding: 0 10px; }
        .header { text-align: center; margin-bottom: 15px; padding: 10px 0; position: relative; }
        .header h1 { color: #1f2937; font-size: 1.8rem; margin-bottom: 5px; }
        .header p { color: #6b7280; font-size: 0.85rem; }
        .sync-indicator { position: absolute; top: 10px; right: 10px; display: flex; align-items: center; gap: 8px; padding: 8px 16px; background: white; border-radius: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); font-size: 0.8rem; cursor: pointer; z-index: 100; transition: all 0.3s; }
        .sync-indicator:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .sync-indicator.synced { border: 2px solid #10b981; color: #059669; }
        .sync-indicator.syncing { border: 2px solid #f59e0b; color: #d97706; }
        .sync-indicator.offline { border: 2px solid #6b7280; color: #6b7280; }
        .sync-indicator.error { border: 2px solid #ef4444; color: #dc2626; }
        .sync-dot { width: 8px; height: 8px; border-radius: 50%; animation: pulse 2s infinite; }
        .sync-dot.green { background: #10b981; }
        .sync-dot.yellow { background: #f59e0b; }
        .sync-dot.gray { background: #6b7280; }
        .sync-dot.red { background: #ef4444; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .tabs { display: flex; background: white; border-radius: 10px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); margin-bottom: 15px; overflow: hidden; }
        .tab-button { flex: 1; padding: 12px 8px; border: none; background: transparent; cursor: pointer; font-size: 0.85rem; font-weight: 500; color: #6b7280; transition: all 0.2s; }
        .tab-button.active { background: #3b82f6; color: white; }
        .tab-content { display: none; min-height: calc(100vh - 160px); }
        .tab-content.active { display: block; }
        .main-grid { display: grid; grid-template-columns: 1fr; gap: 15px; }
        @media (min-width: 768px) { .main-grid { grid-template-columns: 1fr 2fr; } }
        .card { background: white; border-radius: 10px; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.08); padding: 16px; }
        .card-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px; }
        .card-title { font-size: 1.1rem; font-weight: 600; color: #1f2937; }
        .form-group { background: #f9fafb; padding: 12px; border-radius: 6px; margin-bottom: 10px; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; margin-bottom: 6px; }
        .form-row-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 6px; }
        .input, .select, .textarea { padding: 6px 10px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 0.8rem; width: 100%; }
        .textarea { resize: vertical; min-height: 60px; }
        .btn { padding: 6px 12px; border: none; border-radius: 4px; font-size: 0.8rem; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 3px; transition: all 0.2s; font-weight: 500; }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; }
        .btn-primary { background: #3b82f6; color: white; }
        .btn-primary:hover:not(:disabled) { background: #2563eb; }
        .btn-secondary { background: #6b7280; color: white; }
        .btn-success { background: #059669; color: white; }
        .btn-danger { background: #ef4444; color: white; font-size: 0.75rem; padding: 4px 8px; }
        .btn-clear { background: transparent; color: #ef4444; border: 1px solid #ef4444; font-size: 0.75rem; padding: 4px 8px; }
        .ingredient-item { display: flex; align-items: center; justify-content: space-between; padding: 12px; background: white; border-radius: 8px; margin-bottom: 8px; border: 1px solid #e5e7eb; transition: all 0.2s; }
        .ingredient-item:hover { border-color: #3b82f6; background: #f8fafc; }
        .dish-item { padding: 12px; background: #f9fafb; border-radius: 6px; margin-bottom: 6px; border: 2px solid; }
        .dish-available { background: #f0fdf4; border-color: #bbf7d0; }
        .dish-missing { background: #fff7ed; border-color: #fed7aa; }
        .stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-top: 15px; }
        .stat-card { background: white; border-radius: 6px; box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1); padding: 12px; text-align: center; }
        .stat-number { font-size: 1.3rem; font-weight: bold; margin-bottom: 2px; }
        .stat-label { color: #6b7280; font-size: 0.8rem; }
        .empty-message { text-align: center; color: #6b7280; padding: 15px; font-size: 0.8rem; }
        .modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 2000; }
        .modal.show { display: flex; }
        .modal-content { background: white; border-radius: 16px; padding: 28px; max-width: 500px; width: 90%; max-height: 85vh; overflow-y: auto; }
        .loading-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 2000; }
        .loading-overlay.show { display: flex; }
        .loading-content { background: white; padding: 30px; border-radius: 12px; text-align: center; }
        .loading-spinner { width: 40px; height: 40px; border: 4px solid #f3f4f6; border-top: 4px solid #3b82f6; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 15px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .camera-btn { width: 100%; padding: 12px; background: linear-gradient(135deg, #10b981, #059669); color: white; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; margin-bottom: 15px; transition: all 0.2s; }
        .camera-btn:hover { transform: translateY(-1px); box-shadow: 0 4px 8px rgba(16,185,129,0.3); }
        .ai-section { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 10px; padding: 20px; margin-bottom: 15px; }
        .ai-result { background: rgba(255, 255, 255, 0.1); border-radius: 6px; padding: 12px; margin-top: 12px; white-space: pre-wrap; line-height: 1.6; max-height: 400px; overflow-y: auto; }
        .calendar-day { background: white; border: 2px solid #e5e7eb; border-radius: 8px; padding: 8px; text-align: center; cursor: pointer; transition: all 0.2s; min-height: 80px; display: flex; flex-direction: column; }
        .calendar-day:hover { border-color: #3b82f6; background: #f0f9ff; transform: translateY(-2px); }
        .calendar-day.selected { border-color: #3b82f6; background: #dbeafe; }
        .calendar-day.today { background: #fef3c7; border-color: #f59e0b; }
        .sync-code-display { background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; padding: 24px; border-radius: 12px; text-align: center; margin: 20px 0; }
        .sync-code { font-size: 3.5rem; font-weight: bold; letter-spacing: 12px; margin: 20px 0; font-family: 'Courier New', monospace; }
        .status-indicator { padding: 8px 12px; border-radius: 6px; font-size: 0.8rem; margin-top: 10px; display: none; }
        .status-success { background: rgba(34,197,94,0.2); color: #059669; border: 1px solid #bbf7d0; }
        .status-error { background: rgba(239,68,68,0.2); color: #dc2626; border: 1px solid #fca5a5; }
        @media (max-width: 767px) {.sync-indicator { position: static; margin: 10px auto; }.main-grid { grid-template-columns: 1fr; }}
        .voice-btn {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #8b5cf6, #7c3aed);
            color: white;
            border: none; 
            border-radius: 8px; 
            font-size: 1rem; 
            font-weight: 600; 
            cursor: pointer; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            gap: 8px; 
            margin-bottom: 15px; 
            transition: all 0.2s; 
        }
        .voice-btn:hover {transform: translateY(-1px); box-shadow: 0 4px 8px rgba(139,92,246,0.3);}
        .recording-active {animation: pulse-red 1.5s infinite;}
        @keyframes pulse-red { 0%, 100% { background: #ef4444; }   50% { background: #dc2626; } }
        .login-tab {
            flex: 1;
            padding: 10px;
            background: transparent;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            color: #6b7280;
            transition: all 0.2s;
        }
        .login-tab.active {
            background: white;
            color: #3b82f6;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .login-form {
            display: none;
        }
        .login-form.active {
            display: block;
        }
    </style>
</head>
<body>
<!-- åˆå¹¶åçš„ç»Ÿä¸€æ¨¡æ€æ¡† -->
    <div id="loginModal" class="modal">
        <div class="modal-content" style="max-width: 450px;">
            <h2 style="margin-bottom: 24px; color: #1f2937; font-weight: 700; text-align: center;">
                ğŸ‘¤ ç”¨æˆ·ç™»å½• & åŒæ­¥
            </h2>
            
            <!-- ç™»å½•æ–¹å¼åˆ‡æ¢æ ‡ç­¾ -->
            <div style="display: flex; background: #f3f4f6; border-radius: 8px; padding: 4px; margin-bottom: 20px;">
                <button id="phoneLoginTab" class="login-tab active" onclick="switchLoginTab('phone')">
                    ğŸ“± æ‰‹æœºç™»å½•
                </button>
                <button id="syncCodeTab" class="login-tab" onclick="switchLoginTab('sync')">
                    ğŸ”„ åŒæ­¥ç 
                </button>
            </div>
            
            <!-- æ‰‹æœºå·ç™»å½•è¡¨å• -->
            <div id="phoneLoginForm" class="login-form active">
                <div id="loginFormContent">
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; margin-bottom: 6px; color: #374151; font-weight: 500;">æ‰‹æœºå·</label>
                        <input type="tel" id="phoneNumber" class="input" placeholder="è¯·è¾“å…¥æ‰‹æœºå·" maxlength="11" style="width: 100%; padding: 10px;">
                    </div>
                    
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; margin-bottom: 6px; color: #374151; font-weight: 500;">å¯†ç </label>
                        <input type="password" id="password" class="input" placeholder="è¯·è¾“å…¥å¯†ç " style="width: 100%; padding: 10px;">
                    </div>
                    
                    <div style="display: flex; gap: 12px; margin-bottom: 12px;">
                        <button id="loginBtn" class="btn btn-primary" style="flex: 1; padding: 12px;">
                            ç™»å½•
                        </button>
                        <button id="registerBtn" class="btn btn-success" style="flex: 1; padding: 12px;">
                            æ³¨å†Œ
                        </button>
                    </div>
                    
                    <div id="loginMessage" class="status-indicator" style="display: none; margin-top: 12px;"></div>
                </div>
                
                <!-- å·²ç™»å½•çŠ¶æ€ -->
                <div id="loggedInInfo" style="display: none;">
                    <div style="background: #f0fdf4; border: 2px solid #10b981; border-radius: 8px; padding: 20px; text-align: center;">
                        <div style="font-size: 2rem; margin-bottom: 10px;">âœ…</div>
                        <div style="font-weight: 600; color: #059669; margin-bottom: 8px;">å·²ç™»å½•</div>
                        <div id="currentUserPhone" style="font-size: 1.2rem; color: #374151; margin-bottom: 16px;"></div>
                        <button id="logoutBtn" class="btn btn-danger" style="width: 100%; padding: 10px;">
                            é€€å‡ºç™»å½•
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- åŒæ­¥ç è¡¨å• -->
            <div id="syncCodeForm" class="login-form" style="display: none;">
                <!-- åŒæ­¥çŠ¶æ€ä¿¡æ¯ -->
                <div id="syncStatusInfo" style="background: #fef3c7; border-left: 4px solid #f59e0b; padding: 12px; border-radius: 4px; margin-bottom: 20px; font-size: 0.85rem;">
                    <strong>ğŸ’¡ çŠ¶æ€:</strong><span id="syncStatusText">æ­£åœ¨æ£€æŸ¥è¿æ¥...</span>
                </div>
                
                <div id="syncCodeSection">
                    <div class="sync-code-display">
                        <div style="font-size: 1.1rem; margin-bottom: 10px;">æ‚¨çš„åŒæ­¥ç </div>
                        <div class="sync-code" id="displaySyncCode">------</div>
                        <div style="font-size: 0.9rem; margin-bottom: 16px;">åœ¨å…¶ä»–è®¾å¤‡è¾“å…¥æ­¤ç å³å¯åŒæ­¥æ•°æ®</div>
                        <button id="copySyncCodeBtn" class="btn" style="background: white; color: #3b82f6; font-weight: 600; padding: 12px 24px;">ğŸ“‹ å¤åˆ¶åŒæ­¥ç </button>
                    </div>
                    <div style="text-align: center; margin: 28px 0; color: #9ca3af; font-weight: 500;">æˆ–</div>
                </div>
                
                <div>
                    <h3 style="margin-bottom: 14px; color: #374151; font-weight: 600;">è¾“å…¥å…¶ä»–è®¾å¤‡çš„åŒæ­¥ç </h3>
                    <div style="display: flex; gap: 12px;">
                        <input type="text" id="inputSyncCode" class="input" placeholder="123456" maxlength="6" style="flex: 1; text-align: center; font-size: 1.8rem; letter-spacing: 6px; font-family: 'Courier New', monospace;">
                        <button id="useSyncCodeBtn" class="btn btn-success" style="padding: 12px 24px; font-weight: 600;">ğŸ”„ åŒæ­¥</button>
                    </div>
                </div>
            </div>
            
            <button id="closeLoginModalBtn" class="btn btn-secondary" style="width: 100%; margin-top: 20px;">å…³é—­</button>
        </div>
    </div>

    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div id="loadingText">å¤„ç†ä¸­...</div>
        </div>
    </div>

    <!-- æ–°å¢è¯­éŸ³è¯†åˆ«æ¨¡æ€æ¡† -->
    <div id="voiceModal" class="modal">
        <div class="modal-content" style="max-width: 500px;">
            <h2 style="margin-bottom: 24px; color: #1f2937; font-weight: 700;">ğŸ¤ è¯­éŸ³è¯†åˆ«é£Ÿæ</h2>
            
            <div id="voiceSection">
                <!-- å½•éŸ³æ§åˆ¶åŒº -->
                <div style="text-align: center; margin-bottom: 20px;">
                    <div id="recordingStatus" style="margin-bottom: 20px; padding: 15px; background: #f3f4f6; border-radius: 8px; min-height: 60px; display: flex; align-items: center; justify-content: center;">
                        <span style="color: #6b7280;">å‡†å¤‡å½•éŸ³...</span>
                    </div>
                    
                    <div id="recordingVisualizer" style="height: 60px; background: #1f2937; border-radius: 8px; margin-bottom: 20px; display: none; position: relative; overflow: hidden;">
                        <canvas id="visualizerCanvas" style="width: 100%; height: 100%;"></canvas>
                    </div>
                    
                    <div style="display: flex; gap: 12px; justify-content: center;">
                        <button id="startRecordBtn" class="btn btn-primary" style="padding: 12px 24px; font-size: 1rem;">
                            ğŸ”´ å¼€å§‹å½•éŸ³
                        </button>
                        <button id="stopRecordBtn" class="btn btn-danger" style="padding: 12px 24px; font-size: 1rem; display: none;">
                            â¹ï¸ åœæ­¢å½•éŸ³
                        </button>
                        <button id="playRecordBtn" class="btn btn-success" style="padding: 12px 24px; font-size: 1rem; display: none;">
                            â–¶ï¸ æ’­æ”¾å½•éŸ³
                        </button>
                    </div>
                </div>
                
                <!-- è¯†åˆ«ç»“æœåŒº -->
                <div id="voiceResults" style="margin-top: 20px;"></div>
            </div>
            
            <button id="closeVoiceModalBtn" class="btn btn-secondary" style="width: 100%; margin-top: 20px;">å…³é—­</button>
        </div>
    </div>
    
    <!-- æ‘„åƒå¤´æ¨¡æ€æ¡† -->
    <div id="cameraModal" class="modal">
        <div class="modal-content" style="max-width: 600px;">
            <h2 style="margin-bottom: 24px; color: #1f2937; font-weight: 700;">ğŸ“¸ æ‹ç…§è¯†åˆ«é£Ÿæ</h2>
            <div id="cameraContainer"></div>
            <button id="closeCameraModalBtn" class="btn btn-secondary" style="width: 100%; margin-top: 20px;">å…³é—­</button>
        </div>
    </div>

    <!-- ä¸»ä½“å†…å®¹éƒ¨åˆ† (çœç•¥,ä¿æŒåŸæ ·) -->
    <!-- ... å…¶ä½™HTMLå†…å®¹ä¿æŒä¸å˜ ... -->

    <script>
        // ============ æ ¸å¿ƒå˜é‡ ============
        let ingredients = [];
        let customDishes = [];
        let weeklyMenu = {};
        let cookedDishes = {};
        let currentUserId = localStorage.getItem('currentUserId') || 'default_user';
        let currentSyncCode = localStorage.getItem('currentSyncCode') || null;
        let isPhoneLogin = localStorage.getItem('isPhoneLogin') === 'true';
        let currentUserPhone = localStorage.getItem('currentUserPhone') || null;
        let leanCloudInitialized = false;
        let tempDishIngredients = [];

        // ============ ç»Ÿä¸€çš„åŒæ­¥ç ç®¡ç†å‡½æ•° ============
        /**
         * æ›´æ–°åŒæ­¥ç æ˜¾ç¤ºï¼ˆç”¨äºç™»å½•æ¨¡æ€æ¡†ï¼‰
         */
        function updateSyncCodeDisplay() {
            const statusText = document.getElementById('syncStatusText');
            const codeDisplay = document.getElementById('displaySyncCode');
            
            if (!leanCloudInitialized) {
                statusText.textContent = 'äº‘åŒæ­¥æœªå¯ç”¨,å½“å‰ä¸ºç¦»çº¿æ¨¡å¼';
                codeDisplay.textContent = '------';
            } else if (currentSyncCode) {
                statusText.textContent = 'äº‘åŒæ­¥å·²å¯ç”¨';
                codeDisplay.textContent = currentSyncCode;
            } else {
                statusText.textContent = 'æ­£åœ¨è¿æ¥äº‘æœåŠ¡...';
                codeDisplay.textContent = '------';
            }
        }

        /**
         * å¤åˆ¶åŒæ­¥ç 
         */
        function copySyncCode() {
            if (currentSyncCode) {
                navigator.clipboard.writeText(currentSyncCode).then(() => {
                    alert('âœ… åŒæ­¥ç å·²å¤åˆ¶!\n\n' + currentSyncCode);
                }).catch(() => {
                    alert('åŒæ­¥ç : ' + currentSyncCode);
                });
            } else {
                alert('åŒæ­¥ç å°šæœªç”Ÿæˆ');
            }
        }

        /**
         * ä½¿ç”¨è¾“å…¥çš„åŒæ­¥ç è¿›è¡ŒåŒæ­¥
         */
        async function useSyncCode() {
            const code = document.getElementById('inputSyncCode').value.trim();
            
            if (!leanCloudInitialized) {
                alert('äº‘åŒæ­¥æœªå¯ç”¨');
                return;
            }
            
            if (code.length !== 6) {
                alert('è¯·è¾“å…¥6ä½åŒæ­¥ç ');
                return;
            }
            
            showLoading('æ­£åœ¨åŒæ­¥æ•°æ®...');
            
            try {
                const SyncCode = AV.Object.extend('SyncCode');
                const query = new AV.Query(SyncCode);
                query.equalTo('code', code);
                
                const codeObj = await query.first();
                
                if (!codeObj) {
                    hideLoading();
                    alert('âŒ åŒæ­¥ç ä¸å­˜åœ¨');
                    return;
                }
                
                const targetUserId = codeObj.get('userId');
                
                const UserData = AV.Object.extend('UserData');
                const dataQuery = new AV.Query(UserData);
                dataQuery.equalTo('userId', targetUserId);
                
                const dataObj = await dataQuery.first();
                
                if (dataObj) {
                    ingredients = dataObj.get('ingredients') || [];
                    customDishes = dataObj.get('customDishes') || [];
                    weeklyMenu = dataObj.get('weeklyMenu') || {};
                    cookedDishes = dataObj.get('cookedDishes') || {};
                    
                    currentUserId = targetUserId;
                    currentSyncCode = code;
                    
                    saveData();
                    renderAll();
                    
                    // é‡æ–°ç›‘å¬æ–°ç”¨æˆ·çš„æ•°æ®
                    listenToDataChanges();
                    
                    document.getElementById('loginModal').classList.remove('show');
                    alert('âœ… æ•°æ®åŒæ­¥æˆåŠŸ!');
                } else {
                    alert('âŒ æœªæ‰¾åˆ°æ•°æ®');
                }
            } catch (error) {
                console.error('åŒæ­¥å¤±è´¥:', error);
                alert('âŒ åŒæ­¥å¤±è´¥: ' + error.message);
            } finally {
                hideLoading();
            }
        }

        // ============ ç™»å½•ç›¸å…³å‡½æ•° ============
        function switchLoginTab(tab) {
            const phoneTab = document.getElementById('phoneLoginTab');
            const syncTab = document.getElementById('syncCodeTab');
            const phoneForm = document.getElementById('phoneLoginForm');
            const syncForm = document.getElementById('syncCodeForm');
            
            if (tab === 'phone') {
                phoneTab.classList.add('active');
                syncTab.classList.remove('active');
                phoneForm.classList.add('active');
                syncForm.classList.remove('active');
                
                // æ£€æŸ¥ç™»å½•çŠ¶æ€
                if (isPhoneLogin && currentUserPhone) {
                    showLoggedInState();
                } else {
                    showLoginForm();
                }
            } else {
                phoneTab.classList.remove('active');
                syncTab.classList.add('active');
                phoneForm.classList.remove('active');
                syncForm.classList.add('active');
                
                // æ›´æ–°åŒæ­¥ç æ˜¾ç¤º
                updateSyncCodeDisplay();
            }
        }

        function showLoginForm() {
            document.getElementById('loginFormContent').style.display = 'block';
            document.getElementById('loggedInInfo').style.display = 'none';
        }

        function showLoggedInState() {
            document.getElementById('loginFormContent').style.display = 'none';
            document.getElementById('loggedInInfo').style.display = 'block';
            document.getElementById('currentUserPhone').textContent = currentUserPhone;
        }

        function openLoginModal() {
            const modal = document.getElementById('loginModal');
            modal.classList.add('show');
            
            // ç¡®ä¿åŒæ­¥ç å·²æ›´æ–°
            updateSyncCodeDisplay();
            // æ ¹æ®å½“å‰ç™»å½•çŠ¶æ€é€‰æ‹©é»˜è®¤æ ‡ç­¾
            if (isPhoneLogin) {
                switchLoginTab('phone');
            } else {
                switchLoginTab('sync');
            }
        }

        // ä¿æŒå‘åå…¼å®¹ï¼šopenSyncModal ä¹Ÿæ‰“å¼€ç™»å½•æ¨¡æ€æ¡†å¹¶åˆ‡æ¢åˆ°åŒæ­¥æ ‡ç­¾
        function openSyncModal() {
            openLoginModal();
            switchLoginTab('sync');
        }

        // ============ å ä½å‡½æ•°ï¼ˆå®é™…é¡¹ç›®ä¸­éœ€è¦å®ç°ï¼‰ ============
        function loginWithPhone() {
            console.log('ç™»å½•åŠŸèƒ½å¾…å®ç°');
            alert('æ‰‹æœºç™»å½•åŠŸèƒ½å¾…å®ç°');
        }

        function registerWithPhone() {
            console.log('æ³¨å†ŒåŠŸèƒ½å¾…å®ç°');
            alert('æ³¨å†ŒåŠŸèƒ½å¾…å®ç°');
        }

        function logout() {
            isPhoneLogin = false;
            currentUserPhone = null;
            localStorage.removeItem('isPhoneLogin');
            localStorage.removeItem('currentUserPhone');
            alert('å·²é€€å‡ºç™»å½•');
            switchLoginTab('phone');
        }

        function showLoading(text) {
            document.getElementById('loadingOverlay').classList.add('show');
            document.getElementById('loadingText').textContent = text;
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('show');
        }

        function saveData() {
            localStorage.setItem('ingredients', JSON.stringify(ingredients));
            localStorage.setItem('customDishes', JSON.stringify(customDishes));
            localStorage.setItem('weeklyMenu', JSON.stringify(weeklyMenu));
            localStorage.setItem('cookedDishes', JSON.stringify(cookedDishes));
            localStorage.setItem('currentSyncCode', currentSyncCode || '');
        }

        function renderAll() {
            console.log('æ¸²æŸ“UI');
        }

        function listenToDataChanges() {
            console.log('ç›‘å¬æ•°æ®å˜åŒ–');
        }

        function initLeanCloud() {
            console.log('åˆå§‹åŒ–LeanCloud');
            leanCloudInitialized = true;
            // å®é™…é¡¹ç›®ä¸­çš„åˆå§‹åŒ–ä»£ç 
        }

        // ============ äº‹ä»¶ç›‘å¬ ============
        document.addEventListener('DOMContentLoaded', () => {
            // ç™»å½•ç›¸å…³äº‹ä»¶
            document.getElementById('loginBtn').onclick = loginWithPhone;
            document.getElementById('registerBtn').onclick = registerWithPhone;
            document.getElementById('logoutBtn').onclick = logout;
            document.getElementById('closeLoginModalBtn').onclick = () => {
                document.getElementById('loginModal').classList.remove('show');
            };
            
            // åŒæ­¥ç ç›¸å…³äº‹ä»¶
            document.getElementById('copySyncCodeBtn').onclick = copySyncCode;
            document.getElementById('useSyncCodeBtn').onclick = useSyncCode;
            
            // æ‰‹æœºå·è¾“å…¥æ ¼å¼åŒ–
            document.getElementById('phoneNumber').oninput = (e) => {
                e.target.value = e.target.value.replace(/\D/g, '').slice(0, 11);
            };
            
            // å›è½¦é”®ç™»å½•
            document.getElementById('password').onkeypress = (e) => {
                if (e.key === 'Enter') {
                    loginWithPhone();
                }
            };

            // åˆå§‹åŒ–
            try {
                initLeanCloud();
            } catch (e) {
                console.error('LeanCloudåˆå§‹åŒ–å¤±è´¥:', e);
            }
        });
    </script>
</body>
</html>
